var socket,hiddenEventDataset;document.addEventListener("DOMContentLoaded",()=>{hiddenEventDataset=document.querySelector(".hidden_event_data_url").dataset,socket=connectToSocket(hiddenEventDataset.andromedaUrl,hiddenEventDataset.eventId,"codephod2",hiddenEventDataset.userId),[".next_problem",".previous_problem",".list_of_problems"].forEach(e=>{document.querySelectorAll(e).forEach(e=>e.addEventListener("click",()=>{window.onbeforeunload=null}))});var e=localStorage.getItem("eLID");null==e||""==e||"undefined"==e?getNewCookieToken():createLoginTracker(e)}),problemLive=(e=>{var t=hiddenEventDataset.problemId,n=hiddenEventDataset.userEventId,o=hiddenEventDataset.aliveStatusUrlPath;try{postData(o,{problem_id:t,user_event_id:n,status:e}).then(e=>{e.ok||setTimeout(()=>problemLive(!0),5e3)})["catch"](()=>{setTimeout(()=>problemLive(!0),5e3)})}catch(a){notifyError(a.message),setTimeout(()=>problemLive(!0),5e3)}}),unloadBind=(()=>(problemLive(!1),document.querySelector("body").addEventListener("mousemove",unloadCancel),"Changes will not be saved!")),unloadCancel=(()=>{problemLive(!0),document.querySelector("body").removeEventListener("mousemove",unloadCancel)}),window.onbeforeunload=unloadBind,window.addEventListener("load",()=>problemLive(!0)),history.pushState(null,null,null),window.addEventListener("popstate",()=>{window.onbeforeunload=null,window.location=hiddenEventDataset.eventPath,history.pushState(null,null,null)}),document.addEventListener("keypress",e=>{var t=e.which||e.keyCode||e.charCode||0;!e.metaKey||116!=t&&114!=t&&18!=t||(window.onbeforeunload=null)}),fingerprint=(()=>(new Fingerprint).get()),userEventId=(()=>hiddenEventDataset.eventId),createLoginTracker=(e=>{try{localStorage.setItem("elIntIP","Not found"),getIPs(function(e){localStorage.setItem("elIntIP",e)}),setTimeout(function(){internal_ip=localStorage.getItem("elIntIP"),createPostRequest(e,internal_ip)},5e3)}catch(t){createPostRequest(e,"Not found")}}),createPostRequest=((e,t)=>{try{postData("/events/create_login_tracker",{user_event_id:userEventId(),fingerprint:fingerprint(),elitmus_cookie_token:e,internal_ip:t})["catch"](e=>notifyError(e.message))}catch(n){notifyError(n.message)}}),getNewCookieToken=(()=>{try{getData("/events/new_cookie_token").then(e=>e.json()).then(e=>setCookieTokenAndCreateTracker(e))["catch"](e=>notifyError(e.message))}catch(e){notifyError(e.message)}}),setCookieTokenAndCreateTracker=(e=>{elitmus_cookie_token=e.cookie_token,localStorage.setItem("eLID",elitmus_cookie_token),createLoginTracker(elitmus_cookie_token)});